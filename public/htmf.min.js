(()=>{self.hf={},hf.version="0.5";const p=t=>e=>e.hasAttribute(t),d=new WeakMap;function h(t,e,n){t.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:n}))}document.addEventListener("submit",async t=>{const e=t instanceof HTMLFormElement?t:t.target,n=document.activeElement;if(![e,n].find(p("hf-ignore"))&&(t?.preventDefault(),!d.get(e))){d.set(e,!0);try{const a=new FormData(e),l=n.formMethod||e.method,s=new URL(p("formAction")(n)&&n.formAction||e.action),i={method:l,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(l==="post")i.body=new URLSearchParams([...a]);else for(let c of a.entries())s.searchParams.append(...c);const o=await fetch(s.href,i);if(o.redirected){location.href=o.url;return}const r=o.headers.get("content-type");if(r&&r.indexOf("application/json")>-1){let c=JSON.parse(await o.json());h(n,"hf:json",{data:c,form:e,button:n})}else if(r&&r.indexOf("html")>-1){let c=await o.text();b({text:c,form:e,button:n})}else[204,400].includes(o.status)||console.error(`Unhandled content type "${r}"`);let f=o.headers.get("hf-events");if(f){let c=JSON.parse(f);for(let[w,g]of Object.entries(c))h(n,w,g)}}catch(a){console.error(a),e instanceof HTMLFormElement&&e.submit()}finally{d.delete(e)}}});function u(t,e){return t.getAttribute(e)}function m(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content}function b({text:t,form:e,button:n}){if(t===void 0)return;let a=u(n,"target")??u(e,"target"),l=u(n,"hf-swap")??u(e,"hf-swap")??"innerHTML",s=(a?document.querySelector(a):e)??e;switch(l){case"innerHTML":s.innerHTML=t;break;case"outerHTML":s.outerHTML=t;break;case"append":s.append(m(t));break;case"prepend":s.prepend(m(t));break;case"oob":for(let o of m(t).childNodes){if(!(o instanceof HTMLElement))continue;let r=o.id??o.dataset.id,f=document.getElementById(r);if(!f){console.warn(`The target ${r} could not be found for swap.`);continue}f.replaceWith(o)}break;default:console.warn(`Unknown swap type: "${l}".`)}var i=document.querySelector("[autofocus]");i instanceof HTMLElement&&(i.removeAttribute("autofocus"),i.focus())}})();
