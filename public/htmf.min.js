(()=>{self.hf={},hf.version="0.2";const h=t=>e=>e?.hasAttribute(t),m=new WeakMap;async function l(t,e,n){t.isConnected||(t=document);let a=t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n}));if(n?.wait&&await n.wait(),!a)return Promise.reject()}document.addEventListener("hf:swap",async t=>{const{detail:e}=t;y(e)}),document.addEventListener("submit",async t=>{const e=t instanceof HTMLFormElement?t:t.target;let n=document.activeElement;n?.form!==e&&(n=void 0);const a=n??e;if([e,n].find(h("hf-ignore"))||(t?.preventDefault(),m.get(e)))return;m.set(e,1);const f=n?.formMethod||e.method,r={form:e,button:n,method:f};try{const i=new FormData(e),c=new URL(h("formAction")(n)&&n?.formAction||e.action),u={method:f,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(f==="post")u.body=new URLSearchParams([...i]);else for(let s of i.entries())c.searchParams.append(...s);r.xhr={url:c,options:u},await l(a,"hf:beforeRequest",r);const o=await fetch(c.href,u);if(r.xhr.response=o,await l(a,"hf:afterRequest",r),o.redirected){location.href=o.url;return}if(o.status===205){let s=o.headers.get("location");s&&(location.href=s);return}const g=o.headers.get("content-type");if(g?.includes("application/json")){let s=JSON.parse(await o.json());await l(a,"hf:json",{...r,data:s})}else if(g?.includes("html")){let s=await o.text();await l(a,"hf:swap",{...r,text:s})}else(o.status<200||o.status>399)&&await l(a,"hf:responseError",r);let b=o.headers.get("hf-events");try{if(b){let s=JSON.parse(b);await Promise.all(Object.entries(s).map(([H,T])=>l(a,H,T)))}}catch(s){console.error(s,b)}}catch(i){console.error(i),e instanceof HTMLFormElement&&e.submit()}finally{m.delete(e),await l(a,"hf:completed",r)}});function d(t,e){return t?.getAttribute(e)}function p(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content}function y({text:t,form:e,button:n}){if(t==null)return;L();let a=d(n,"target")??d(e,"target"),f=d(n,"hf-swap")??d(e,"hf-swap")??"innerHTML",r=(a?document.querySelector(a):e)??e;switch(f){case"innerHTML":r.innerHTML=t;break;case"outerHTML":r.outerHTML=t;break;case"append":r.append(p(t));break;case"prepend":r.prepend(p(t));break;case"oob":for(let c of p(t).childNodes){if(!(c instanceof HTMLElement))continue;let u=c.id??c.dataset.id,o=document.getElementById(u);if(!o){console.warn(`The target ${u} could not be found for swap.`);continue}o.replaceWith(c)}break;default:console.warn(`Unknown swap type: "${f}".`)}var i=document.querySelector("[autofocus]");i instanceof HTMLElement?(i.removeAttribute("autofocus"),i.focus()):[e,n].find(h("hf-ignore-scroll"))||v()}let w;function L(){w={y:window.scrollY,height:document.body.scrollHeight}}function v(){if(!w)return;let{y:t,height:e}=w;if(t){let n=t+document.body.scrollHeight-e;n!==t&&window.scrollTo({top:n,behavior:"smooth"})}}})();
