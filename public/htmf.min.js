(()=>{self.hf={},hf.version="0.5";const u=t=>e=>e.hasAttribute(t),h=new WeakMap;function b(t,e,n){t.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:n}))}document.addEventListener("submit",async t=>{const e=t instanceof HTMLFormElement?t:t.target,n=document.activeElement;if(![e,n].find(u("hf-ignore"))&&(t?.preventDefault(),!h.get(e))){h.set(e,!0);try{const a=new FormData(e),l=n.formMethod||e.method,s=new URL(u("formAction")(n)&&n.formAction||e.action),c={method:l,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(l==="post")c.body=new URLSearchParams([...a]);else for(let i of a.entries())s.searchParams.append(...i);const o=await fetch(s.href,c);if(o.redirected){location.href=o.url;return}const r=o.headers.get("content-type");if(r&&r.indexOf("application/json")>-1){let i=JSON.parse(await o.json());b(n,"hf:json",{data:i,form:e,button:n})}else if(r&&r.indexOf("html")>-1){let i=await o.text();g({text:i,form:e,button:n})}else[204,400].includes(o.status)||console.error(`Unhandled content type "${r}"`);let f=o.headers.get("hf-events");if(f){let i=JSON.parse(f);for(let[v,H]of Object.entries(i))b(n,v,H)}}catch(a){console.error(a),e instanceof HTMLFormElement&&e.submit()}finally{h.delete(e)}}});function d(t,e){return t.getAttribute(e)}function m(t){const e=document.createElement("template");return e.innerHTML=t.trim(),e.content}function g({text:t,form:e,button:n}){if(t===void 0)return;w();let a=d(n,"target")??d(e,"target"),l=d(n,"hf-swap")??d(e,"hf-swap")??"innerHTML",s=(a?document.querySelector(a):e)??e;switch(l){case"innerHTML":s.innerHTML=t;break;case"outerHTML":s.outerHTML=t;break;case"append":s.append(m(t));break;case"prepend":s.prepend(m(t));break;case"oob":for(let o of m(t).childNodes){if(!(o instanceof HTMLElement))continue;let r=o.id??o.dataset.id,f=document.getElementById(r);if(!f){console.warn(`The target ${r} could not be found for swap.`);continue}f.replaceWith(o)}break;default:console.warn(`Unknown swap type: "${l}".`)}var c=document.querySelector("[autofocus]");c instanceof HTMLElement?(c.removeAttribute("autofocus"),c.focus()):[e,n].find(u("hf-ignore-scroll"))||y()}let p;function w(){p={y:window.scrollY,height:document.body.scrollHeight}}function y(){if(!p)return;let{y:t,height:e}=p;if(t){let n=t+document.body.scrollHeight-e;n!==t&&window.scrollTo({top:n,behavior:"smooth"})}}})();
