(()=>{document.querySelectorAll("[hf-hidden]").forEach(o=>o instanceof HTMLElement&&(o.style.visibility="hidden")),document.addEventListener("submit",async o=>{try{const t=o.target,e=document.activeElement;if(t.hasAttribute("hf-ignore")||e.hasAttribute("hf-ignore"))return;o.preventDefault();const s=new FormData(t),n=e.formMethod||t.method,r=new URL(e.getAttribute("formAction")&&e.formAction||t.action),l={method:n,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(n==="post")l.body=new URLSearchParams([...s]);else{const a=new URLSearchParams(s).toString();a&&(r.search+=(r.search?"&":"?")+a)}const i=await fetch(r.href,l);if(i.redirected){location.href=i.url;return}const d=i.headers.get("content-type");if(d&&d.indexOf("application/json")!==-1){let a=JSON.parse(await i.json());document.dispatchEvent(new CustomEvent("received-json",{bubbles:!1,detail:{data:a,form:t,button:e}}))}else if(d.indexOf("html")>-1){let a=await i.text();f({text:a,form:t})}else console.error(`Unhandled content type "${d}"`)}catch(t){console.error(t);var c=o?.target;c instanceof HTMLFormElement&&c.submit()}});function f(o){const c=document.createElement("template");c.innerHTML=o.text.trim();for(const e of c.content.childNodes){if(!(e instanceof HTMLElement))continue;const s=e.getAttribute("target");let n,r;switch(s?(n=document.querySelector(s),r=e.getAttribute("hf-swap")||"append"):e.id?n=document.getElementById(e.id):n=document.body,n||(n=o.form),r){case"append":n.append(e);break;case"prepend":n.prepend(e);break;case"replace":default:n.replaceWith(e)}}var t=document.querySelector("[autofocus]");t instanceof HTMLElement&&(t.removeAttribute("autofocus"),t.focus())}})();
