(()=>{self.hf={},hf.version="0.4";const p=e=>t=>t.hasAttribute(e),d=new WeakMap;function h(e,t,n){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:n}))}document.addEventListener("submit",async e=>{try{const n=e instanceof HTMLFormElement?e:e.target;if(d.get(n))return;d.set(n,!0);const o=document.activeElement;if([n,o].find(p("hf-ignore")))return;e?.preventDefault();const f=new FormData(n),s=o.formMethod||n.method,l=new URL(p("formAction")(o)&&o.formAction||n.action),c={method:s,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(s==="post")c.body=new URLSearchParams([...f]);else for(let i of f.entries())l.searchParams.append(...i);const r=await fetch(l.href,c);if(r.redirected){location.href=r.url;return}const a=r.headers.get("content-type");if(a&&a.indexOf("application/json")>-1){let i=JSON.parse(await r.json());h(o,"hf:json",{data:i,form:n,button:o})}else if(a&&a.indexOf("html")>-1){let i=await r.text();w({text:i,form:n,button:o})}else console.error(`Unhandled content type "${a}"`);let b=r.headers.get("hf-events");if(b){let i=JSON.parse(b);for(let[g,v]of Object.entries(i))h(o,g,v)}d.delete(n)}catch(n){console.error(n);var t=e?.target;t instanceof HTMLFormElement&&t.submit()}});function u(e,t){return e.getAttribute(t)}function m(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}function w({text:e,form:t,button:n}){if(e===void 0)return;let o=u(n,"target")??u(t,"target"),f=u(n,"hf-swap")??u(t,"hf-swap")??"innerHTML",s=(o?document.querySelector(o):t)??t;switch(f){case"innerHTML":s.innerHTML=e;break;case"outerHTML":s.outerHTML=e;break;case"append":s.append(m(e));break;case"prepend":s.prepend(m(e));break;case"oob":for(let c of m(e).childNodes){if(!(c instanceof HTMLElement))continue;let r=c.id??c.dataset.id,a=document.getElementById(r);if(!a){console.warn(`The target ${r} could not be found for swap.`);continue}a.replaceWith(c)}break;default:console.warn(`Unknown swap type: "${f}".`)}var l=document.querySelector("[autofocus]");l instanceof HTMLElement&&(l.removeAttribute("autofocus"),l.focus())}})();
