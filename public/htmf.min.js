(()=>{self.hf={},hf.version="0.3";const m=e=>t=>t.hasAttribute(e),d=new WeakMap;function h(e,t,n){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:n}))}document.addEventListener("submit",async e=>{try{const n=e.target;if(d.get(n))return;d.set(n,!0);const r=document.activeElement;if([n,r].find(m("hf-ignore")))return;e.preventDefault();const f=new FormData(n),s=r.formMethod||n.method,l=new URL(m("formAction")(r)&&r.formAction||n.action),c={method:s,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(s==="post")c.body=new URLSearchParams([...f]);else for(let i of f.entries())l.searchParams.append(...i);const o=await fetch(l.href,c);if(o.redirected){location.href=o.url;return}const a=o.headers.get("content-type");if(a&&a.indexOf("application/json")>-1){let i=JSON.parse(await o.json());h(r,"hf:json",{data:i,form:n,button:r})}else if(a&&a.indexOf("html")>-1){let i=await o.text();w({text:i,form:n,button:r})}else console.error(`Unhandled content type "${a}"`);let b=o.headers.get("hf-events");if(b){let i=JSON.parse(b);for(let[g,v]of Object.entries(i))h(r,g,v)}d.delete(n)}catch(n){console.error(n);var t=e?.target;t instanceof HTMLFormElement&&t.submit()}});function u(e,t){return e.getAttribute(t)}function p(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}function w({text:e,form:t,button:n}){if(e===void 0)return;let r=u(n,"target")??u(t,"target"),f=u(n,"hf-swap")??u(t,"hf-swap")??"innerHTML",s=(r?document.querySelector(r):t)??t;switch(f){case"innerHTML":s.innerHTML=e;break;case"outerHTML":s.outerHTML=e;break;case"append":s.append(p(e));break;case"prepend":s.prepend(p(e));break;case"oob":for(let c of p(e).childNodes){if(!(c instanceof HTMLElement))continue;let o=c.id??c.dataset.id,a=document.getElementById(o);if(!a){console.warn(`The target ${o} could not be found for swap.`);continue}a.replaceWith(c)}break;default:console.warn(`Unknown swap type: "${f}".`)}var l=document.querySelector("[autofocus]");l instanceof HTMLElement&&(l.removeAttribute("autofocus"),l.focus())}})();
