(()=>{self.hf={},hf.version="0.2";const h=e=>t=>t.hasAttribute(e),m=new WeakMap;function b(e,t,n){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:n}))}document.addEventListener("submit",async e=>{try{const n=e.target;if(m.get(n))return;m.set(n,!0);const o=document.activeElement;if([n,o].find(h("hf-ignore")))return;e.preventDefault();const a=new FormData(n),r=o.formMethod||n.method,c=new URL(h("formAction")(o)&&o.formAction||n.action),i={method:r,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(r==="post")i.body=new URLSearchParams([...a]);else for(let u of a.entries())c.searchParams.append(...u);const s=await fetch(c.href,i);if(s.redirected){location.href=s.url;return}const l=s.headers.get("content-type");if(l&&l.indexOf("application/json")>-1){let u=JSON.parse(await s.json());b(o,"hf:json",{data:u,form:n,button:o})}else if(l&&l.indexOf("html")>-1){let u=await s.text();g({text:u,form:n,button:o})}else console.error(`Unhandled content type "${l}"`);let w=s.headers.get("hf-events");if(w){let u=JSON.parse(w);for(let[L,T]of Object.entries(u))b(o,L,T)}m.delete(n)}catch(n){console.error(n);var t=e?.target;t instanceof HTMLFormElement&&t.submit()}});function f(e,t){return e.getAttribute(t)}function d(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}function g({text:e,form:t,button:n}){if(e==null)return;let o=f(n,"target")??f(t,"target"),a=f(n,"hf-swap")??f(t,"hf-swap")??"innerHTML",r=(o?document.querySelector(o):t)??t;switch(a){case"innerHTML":r.innerHTML=e;break;case"outerHTML":r.outerHTML=e;break;case"append":r.append(d(e));break;case"prepend":r.prepend(d(e));break;case"replace":r.replaceWith(d(e));break;case"oob":for(let i of d(e).childNodes){if(!(i instanceof HTMLElement))continue;let s=i.id??i.dataset.id,l=document.getElementById(s);if(!l){console.warn(`The target ${s} could not be found for swap.`);continue}l.replaceWith(i)}break;default:console.warn(`Unknown swap type: "${a}".`)}var c=document.querySelector("[autofocus]");c instanceof HTMLElement&&(c.removeAttribute("autofocus"),c.focus())}const p={};function v(e,t,n={args:[],wait:50,isImmediate:!1,immediateFirst:!1}){p[t]||(p[t]=n);const o=p[t];let a=o.timeoutId;const r=this,c=function(){a=void 0,o.isImmediate||e.apply(r,o.args)},i=(o.isImmediate||o.immediateFirst)&&a===void 0;o.immediateFirst=!1,a!==void 0&&clearTimeout(a),o.timeoutId=setTimeout(c,o.wait),i&&e.apply(r,o.args)}function y(e){if(typeof e=="string"){let n=document.querySelector(e);n instanceof HTMLElement&&n.click()}else{var t=e.form;if(!t)return;(t.querySelector("button")||t.querySelector("[type='submit']"))?.click()}}hf={debounce:v,click:y}})();
