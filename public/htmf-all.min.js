(()=>{self.hf={},hf.version="0.3";const h=e=>t=>t.hasAttribute(e),d=new WeakMap;function b(e,t,n){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:n}))}document.addEventListener("submit",async e=>{try{const n=e.target;if(d.get(n))return;d.set(n,!0);const o=document.activeElement;if([n,o].find(h("hf-ignore")))return;e.preventDefault();const r=new FormData(n),a=o.formMethod||n.method,c=new URL(h("formAction")(o)&&o.formAction||n.action),i={method:a,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(a==="post")i.body=new URLSearchParams([...r]);else for(let u of r.entries())c.searchParams.append(...u);const s=await fetch(c.href,i);if(s.redirected){location.href=s.url;return}const l=s.headers.get("content-type");if(l&&l.indexOf("application/json")>-1){let u=JSON.parse(await s.json());b(o,"hf:json",{data:u,form:n,button:o})}else if(l&&l.indexOf("html")>-1){let u=await s.text();g({text:u,form:n,button:o})}else console.error(`Unhandled content type "${l}"`);let w=s.headers.get("hf-events");if(w){let u=JSON.parse(w);for(let[L,T]of Object.entries(u))b(o,L,T)}d.delete(n)}catch(n){console.error(n);var t=e?.target;t instanceof HTMLFormElement&&t.submit()}});function f(e,t){return e.getAttribute(t)}function m(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content}function g({text:e,form:t,button:n}){if(e===void 0)return;let o=f(n,"target")??f(t,"target"),r=f(n,"hf-swap")??f(t,"hf-swap")??"innerHTML",a=(o?document.querySelector(o):t)??t;switch(r){case"innerHTML":a.innerHTML=e;break;case"outerHTML":a.outerHTML=e;break;case"append":a.append(m(e));break;case"prepend":a.prepend(m(e));break;case"oob":for(let i of m(e).childNodes){if(!(i instanceof HTMLElement))continue;let s=i.id??i.dataset.id,l=document.getElementById(s);if(!l){console.warn(`The target ${s} could not be found for swap.`);continue}l.replaceWith(i)}break;default:console.warn(`Unknown swap type: "${r}".`)}var c=document.querySelector("[autofocus]");c instanceof HTMLElement&&(c.removeAttribute("autofocus"),c.focus())}const p={};function v(e,t,n={args:[],wait:50,isImmediate:!1,immediateFirst:!1}){p[t]||(p[t]=n);const o=p[t];let r=o.timeoutId;const a=this,c=function(){r=void 0,o.isImmediate||e.apply(a,o.args)},i=(o.isImmediate||o.immediateFirst)&&r===void 0;o.immediateFirst=!1,r!==void 0&&clearTimeout(r),o.timeoutId=setTimeout(c,o.wait),i&&e.apply(a,o.args)}function y(e){if(typeof e=="string"){let n=document.querySelector(e);n instanceof HTMLElement&&n.click()}else{var t=e.form;if(!t)return;(t.querySelector("button")||t.querySelector("[type='submit']"))?.click()}}hf={debounce:v,click:y}})();
