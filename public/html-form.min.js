"use strict";(()=>{let m=document,w=window,b="hf-submitting",y="hf-target",g="hf-swap",M="hf",l=(e,r,t,i,a=null)=>(e.isConnected?e:m).dispatchEvent(new CustomEvent((a??"hf:")+r,{detail:t,cancelable:!0,bubbles:i!==!1,composed:!0})),p=(e,r,t)=>e?.getAttribute(r)||t,S=(e,r)=>t=>p(t,e,r),D=(e,r,t)=>e?.setAttribute(r,t),u=e=>r=>r?.hasAttribute(e),R=document.startViewTransition?.bind(document),E=e=>r=>{let t=p(r,e);if(t)return[t,r]},A={},L={swapOption:A,fetch:w.fetch.bind(w),send:l,attr:p,hasAttr:u};w.htmf=L,m.addEventListener("submit",async e=>{const r=m.activeElement,t=e.target,i=e.submitter,a=i??t,d=[i,t].filter(o=>o);if(d.find(u("hf-ignore"))||![y,M,g].find(o=>d.find(u(o)))||(e.preventDefault(),u(b)(a)))return;D(a,b,"");let x=i?.formMethod||t.method,H=u("formaction")(i)&&i.formAction||t.action,v=new URL(H),n={};try{let o=new FormData(t),[T,U]=d.map(E(y)).find(f=>f)??d.map(E("target")).find(f=>f)??[],s=d.map(S(g)).find(f=>f)||p(m.body,g)||"outerHTML",h=T&&document.querySelector(T)||U||i||t;if(n={action:H,active:r,credentials:"same-origin",event:e,form:t,headers:new Headers({"HF-Request":"true"}),method:x,originator:a,submitter:i,swap:s,target:h,transition:u("hf-transition")(document.body)&&R,url:v},x==="get")for(let f of o.entries())v.searchParams.append(...f);else n.body=new URLSearchParams([...o]);if(!l(a,"before",n))return;let c=n.response=await L.fetch(v,n);if(!l(a,"after",n))return;if(c.redirected&&c.status>299&&c.status<400){location.href=c.url;return}if(c.status===204||(n.text=await c.text(),!l(a,"swap",n)))return;let F=()=>{if(A[s]instanceof Function)return A[s](n);if(/(before|after)(begin|end)/.test(s))h.insertAdjacentHTML(s,n.text);else if(s in h)h[s]=n.text;else if(s!=="none")throw`Unknown swap: ${s}`};n.transition?await n.transition(F).finished:await F(),l(a,"swapped",n),document.contains(h)||l(m,"swapped",n)}catch(o){console.error(o),i instanceof HTMLFormElement?i.submit():i?.click()}finally{a.removeAttribute(b),l(a,"completed",n)}})})();
