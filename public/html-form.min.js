(()=>{let c=document,y=window,m=c.querySelector.bind(c),k="hf-submitting";c.addEventListener("submit",async e=>{const t=c.activeElement,r=e.target,n=e.submitter,i=n??r;if([r,n].find(A("hf-ignore"))||(e.preventDefault(),A(k)(r)))return;q(r,k,"");const a=d(n,"formmethod")??d(r,"method")??"get";let l=d(n,"formaction")??d(r,"action")??"",s=new URL(l,location.origin);const f={form:r,submitter:n,method:a,active:t,originator:i,action:l,url:s};try{const w=new FormData(r),g={method:a,credentials:"same-origin",headers:new Headers({"HF-Request":"true"})};if(a==="post")g.body=new URLSearchParams([...w]);else if(a==="get")for(let b of w.entries())s.searchParams.append(...b);else return;f.xhr={url:s,options:g},await u(i,"hf:request-before",f);const o=await fetch(s,g);if(f.xhr.response=o,await u(i,"hf:request-after",f),o.redirected){location.href=o.url;return}const h=o.headers.get("content-type");if(h?.includes("application/json")){let b=JSON.parse(await o.json());await u(i,"hf:json",{...f,data:b})}else if(h?.includes("html")){let b=await o.text(),L={...f,text:b};await u(i,"hf:swap",L),D(L)}else o.ok||await u(i,"hf:response-error",f);o.status===205&&r.reset();let p=o.headers.get("hf-events");if(p){let b=JSON.parse(p);await Promise.all(Object.entries(b).map(([L,R])=>u(i,L,R)))}}catch(w){console.error(w),q(r,"action",f.action),q(r,"method",f.method),$("submit",r)}finally{r.removeAttribute(k),await u(i,"hf:completed",f)}});function D({text:e,form:t,submitter:r}){if(e==null)return;F(r,t);let n=[r,t],i=v(T("hf-target"),n),a=v(T("hf-swap"),n)??"innerHTML",l=v(T("hf-select"),n);l&&(a="select");let s=(i?m(i):t)??t;switch(a){case"outerHTML":case"innerHTML":s[a]=e,S(s);break;case"append":case"prepend":let f=M(e);s[a](f),S(f);break;case"beforebegin":case"afterbegin":case"beforeend":case"afterend":s.insertAdjacentHTML(a,e);break;case"oob":for(let o of M(e).childNodes){if(!(o instanceof HTMLElement))continue;let h=o.id??o.dataset.id,p=c.getElementById(h);if(!p){console.warn(`The target ${h} could not be found for swap.`);continue}p.replaceWith(o),S(o)}break;case"select":let w=Array.from(M(e).querySelectorAll(l)),g=Array.from(c.querySelectorAll(l));for(let o=0;o<g.length;o++){let h=w[o],p=g[o];!p||!h||(p.replaceWith(h),S(h))}break;default:console.warn(`Unknown swap type: "${a}".`)}n.find(A("hf-scroll-ignore"))||P()}let j=new Set;function S(e){for(let t of e.querySelectorAll("script")){let r=t.src||t.id;if(j.has(r)){C(e,t);continue}j.add(r);const n=c.createElement("script");for(let i of t.attributes)q(n,i.name,i.value);n.appendChild(c.createTextNode(t.innerHTML)),t.replaceWith(n),C(e,n)}}function C(e,t){u(e,"hf:script-loaded",{script:v(r=>d(t,r),["src","id"])},10)}let I=null;y.addEventListener("click",e=>{I=e.target});let E;function F(e,t){let r=c.activeElement,n=r===c.body?I:r,i=v(T("hf-scroll-to"),[e,t]),a=d(n,"hf-scroll-target");a&&(n=m(a));let l=d(n?.closest("[hf-scroll-miss]"),"hf-scroll-miss"),s=d(n,"name");E={y:y.scrollY,to:i,a:{t:{y:H(n),q:n?.id&&`#${n.id}`||s&&`[name="${s}"]`},m:{y:H(m(l)),q:l}}}}function P(){let e=m("[autofocus]");if(e)return e.focus(),e.scrollIntoView({behavior:"auto",block:"center",inline:"center"});if(!E)return;let{y:t,to:r,a:{t:n,m:i}}=E,a=m(r);if(a)return a.scrollIntoView({behavior:"smooth"});let l,s=n.q&&(l=m(n.q))?n.y:i.q&&(l=m(i.q))?i.y:0;A("hf-focus-skip")(l)||($("focus",l),$("select",l)),A("hf-scroll-skip")(c.body)||(l&&s?y.scrollTo({top:y.scrollY+H(l)-s}):y.scrollTo({top:t}))}function H(e){return e?.getBoundingClientRect().top}async function u(e,t,r,n){e.isConnected||(e=c),n&&setTimeout(()=>u(e,t,r),n);let i=e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:r}));if(r?.wait&&await r.wait(),!i)return Promise.reject()}function $(e,t){t&&t[e]instanceof Function&&t[e]()}function v(e,t){for(let r of t){let n=e(r);if(n)return n}}function A(e){return t=>t?.hasAttribute(e)}function T(e){return t=>d(t,e)}function d(e,t){if(e?.hasAttribute(t))return e.getAttribute(t)}function q(e,t,r){e?.setAttribute(t,r)}function M(e){const t=c.createElement("template");return t.innerHTML=e,t.content}})();
