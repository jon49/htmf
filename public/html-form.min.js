"use strict";(()=>{let a=document,D=window,g="hf-submitting",A="hf-target",p="hf-swap",R="hf",u=(t,n,r,i,s=null)=>(t.isConnected?t:a).dispatchEvent(new CustomEvent((s??"hf:")+n,{detail:r,cancelable:!0,bubbles:i!==!1,composed:!0})),w=(t,n,r)=>t?.getAttribute(n)||r,U=(t,n)=>r=>w(r,t,n),k=(t,n,r)=>t?.setAttribute(n,r),f=t=>n=>n?.hasAttribute(t),C=a.startViewTransition?.bind(a),v=t=>n=>{let r=w(n,t);if(r)return[r,n]},E=t=>t&&a.querySelector(t),y={},L={swapOption:y,send:u,attr:w,hasAttr:f};D.htmf=L,a.addEventListener("submit",async t=>{const n=a.activeElement,r=t.target,i=t.submitter,s=i??r,c=[i,r].filter(d=>d);if(c.find(f("hf-ignore"))||![A,R,p].find(d=>c.find(f(d)))||(t.preventDefault(),f(g)(s)))return;k(s,g,"");let T=i?.formMethod||r.method,x=f("formaction")(i)&&i.formAction||r.action,b=new URL(x),e={};try{let d=new FormData(r),[H,q]=c.map(v(A)).find(l=>l)??c.map(v("target")).find(l=>l)??[],h=H&&E(H)||q||i||r,o=c.map(U(p)).find(l=>l)||w(a.body,p)||"outerHTML",F=(f("hf-transition")(a.body)||c.map(f("hf-transition")).find(l=>l))&&F;if(e={action:x,active:n,credentials:"same-origin",event:t,form:r,headers:new Headers({"HF-Request":"true"}),method:T,originator:s,submitter:i,swap:o,target:h,transition:f("hf-transition")(a.body)&&F,url:b},T==="get")for(let l of d.entries())b.searchParams.append(...l);else e.body=new URLSearchParams([...d]);if(!u(s,"before",e))return;let m=e.response=await(L.fetch?.(b,e)??fetch(b,e));if(!u(s,"after",e))return;let M=m.headers.get(A);if(h=e.target=E(M)||h,o=e.swap=m.headers.get(p)||o,m.redirected&&!M){location.href=m.url;return}if(m.status===204||(e.text=await m.text(),!u(s,"swap",e)))return;let S=()=>{if(y[o]instanceof Function)return y[o](e);if(/(before|after)(begin|end)/.test(o))h.insertAdjacentHTML(o,e.text);else if(o in h)h[o]=e.text;else if(o!=="none")throw`Unknown swap: ${o}`};e.transition?await e.transition(S).finished:await S(),u(s,"swapped",e),a.contains(h)||u(a,"swapped",e)}catch(d){console.error(d),i instanceof HTMLFormElement?i.submit():i?.click()}finally{s.removeAttribute(g),u(s,"completed",e)}})})();
