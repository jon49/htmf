"use strict";(()=>{let m=document,b=window,w="hf-submitting",y="hf-target",g="hf-swap",S="hf",u=(e,r,t,i,a=null)=>(e.isConnected?e:m).dispatchEvent(new CustomEvent((a??"hf:")+r,{detail:t,cancelable:!0,bubbles:i!==!1,composed:!0})),p=(e,r,t)=>e?.getAttribute(r)||t,D=(e,r)=>t=>p(t,e,r),R=(e,r,t)=>e?.setAttribute(r,t),f=e=>r=>r?.hasAttribute(e),k=document.startViewTransition?.bind(document),E=e=>r=>{let t=p(r,e);if(t)return[t,r]},A={},L={swapOption:A,fetch:b.fetch.bind(b),send:u,attr:p,hasAttr:f};b.htmf=L,m.addEventListener("submit",async e=>{const r=m.activeElement,t=e.target,i=e.submitter,a=i??t,d=[i,t].filter(l=>l);if(d.find(f("hf-ignore"))||![y,S,g].find(l=>d.find(f(l)))||(e.preventDefault(),f(w)(a)))return;R(a,w,"");let x=i?.formMethod||t.method,H=f("formaction")(i)&&i.formAction||t.action,v=new URL(H),n={};try{let l=new FormData(t),[T,U]=d.map(E(y)).find(o=>o)??d.map(E("target")).find(o=>o)??[],s=d.map(D(g)).find(o=>o)||p(m.body,g)||"outerHTML",h=T&&document.querySelector(T)||U||i||t,F=(f("hf-transition")(document.body)||d.map(f("hf-transition")).find(o=>o))&&F;if(n={action:H,active:r,credentials:"same-origin",event:e,form:t,headers:new Headers({"HF-Request":"true"}),method:x,originator:a,submitter:i,swap:s,target:h,transition:f("hf-transition")(document.body)&&F,url:v},x==="get")for(let o of l.entries())v.searchParams.append(...o);else n.body=new URLSearchParams([...l]);if(!u(a,"before",n))return;let c=n.response=await L.fetch(v,n);if(!u(a,"after",n))return;if(c.redirected&&c.status>299&&c.status<400){location.href=c.url;return}if(c.status===204||(n.text=await c.text(),!u(a,"swap",n)))return;let M=()=>{if(A[s]instanceof Function)return A[s](n);if(/(before|after)(begin|end)/.test(s))h.insertAdjacentHTML(s,n.text);else if(s in h)h[s]=n.text;else if(s!=="none")throw`Unknown swap: ${s}`};n.transition?await n.transition(M).finished:await M(),u(a,"swapped",n),document.contains(h)||u(m,"swapped",n)}catch(l){console.error(l),i instanceof HTMLFormElement?i.submit():i?.click()}finally{a.removeAttribute(w),u(a,"completed",n)}})})();
