"use strict";(()=>{let d=document,w=window,b="hf-submitting",y="hf-target",g="hf-swap",M="hf",l=(e,n,t,i,a=null)=>(e.isConnected?e:d).dispatchEvent(new CustomEvent((a??"hf:")+n,{detail:t,cancelable:!0,bubbles:i!==!1,composed:!0})),p=(e,n,t)=>e.getAttribute(n)||t,S=(e,n)=>t=>p(t,e,n),D=(e,n,t)=>e?.setAttribute(n,t),m=e=>n=>n?.hasAttribute(e),R=document.startViewTransition?.bind(document),E=e=>n=>{let t=p(n,e);if(t)return[t,n]},A={},L={swapOption:A,fetch:w.fetch.bind(w),send:l,attr:p,hasAttr:m};w.htmf=L,d.addEventListener("submit",async e=>{const n=d.activeElement,t=e.target,i=e.submitter,a=i??t,u=[i,t].filter(o=>o);if(u.find(m("hf-ignore"))||![y,M,g].find(o=>u.find(m(o)))||(e.preventDefault(),m(b)(a)))return;D(a,b,"");let x=i?.formMethod||t.method,H=m("formaction")(i)&&i.formAction||t.action,v=new URL(H),r={};try{let o=new FormData(t),[T,U]=u.map(E(y)).find(f=>f)??u.map(E("target")).find(f=>f)??[],s=u.map(S(g)).find(f=>f)||p(d.body,g)||"outerHTML",h=T&&document.querySelector(T)||U||i||t;if(r={action:H,active:n,credentials:"same-origin",event:e,form:t,headers:new Headers({"HF-Request":"true"}),method:x,originator:a,submitter:i,swap:s,target:h,transition:R,url:v},x==="get")for(let f of o.entries())v.searchParams.append(...f);else r.body=new URLSearchParams([...o]);if(!l(a,"before",r))return;let c=r.response=await L.fetch(v,r);if(!l(a,"after",r))return;if(c.redirected&&c.status>299&&c.status<400){location.href=c.url;return}if(c.status===204||(r.text=await c.text(),!l(a,"swap",r)))return;let F=()=>{if(A[s]instanceof Function)return A[s](r);if(/(before|after)(begin|end)/.test(s))h.insertAdjacentHTML(s,r.text);else if(s in h)h[s]=r.text;else if(s!=="none")throw`Unknown swap: ${s}`};r.transition?await r.transition(F).finished:await F(),l(a,"swapped",r),document.contains(h)||l(d,"swapped",r)}catch(o){console.error(o),i instanceof HTMLFormElement?i.submit():i?.click()}finally{a.removeAttribute(b),l(a,"completed",r)}})})();
